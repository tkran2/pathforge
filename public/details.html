<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Details</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2em auto; line-height: 1.6; }
        .nav-links { margin-bottom: 2em; }
        .detail-card { margin-bottom: 1.5em; padding: 1em; border: 1px solid #eee; border-radius: 8px; }
        h1, h2 { border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        ul { padding-left: 20px; }
        strong { color: #333; }
    </style>
</head>
<body>
    <div class="nav-links">
        <a href="/static/dashboard.html">Back to Matches</a> | <a href="/static/assessment.html">Take More Assessments</a>
    </div>

    <div id="details-container">
        <p>Loading job details...</p>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', async function() {
        const container = document.getElementById('details-container');
        const currentUser = localStorage.getItem('pathforge_user') || 'guest';

        const urlParams = new URLSearchParams(window.location.search);
        const socCode = urlParams.get('soc');

        if (!socCode) {
            container.innerHTML = '<h1>Error</h1><p>No job code provided. Please go back to your matches and click on a job.</p>';
            return;
        }

        try {
            const response = await fetch(`/job_details/${currentUser}/${socCode}`);
            if (!response.ok) throw new Error('Job details not found.');

            const data = await response.json();

            let profileMatchHTML = '<h2>Your Profile Match</h2>';

            // FIXED: Add the Aptitudes section
            profileMatchHTML += '<h4>Top Aptitudes Required:</h4><ul>';
            data.profile_match.aptitudes.forEach(item => {
                profileMatchHTML += `<li><strong>${item.name}</strong> (Job Importance: ${item.job_importance.toFixed(2)})</li>`;
            });
            profileMatchHTML += '</ul>';

            profileMatchHTML += '<h4>Top Interests Match:</h4><ul>';
            data.profile_match.interests.forEach(item => {
                profileMatchHTML += `<li><strong>${item.name}:</strong> Your Score: ${item.user_score} (Job Importance: ${item.job_score})</li>`;
            });
            profileMatchHTML += '</ul>';

            profileMatchHTML += '<h4>Top Work Values Match:</h4><ul>';
            data.profile_match.values.forEach(item => {
                profileMatchHTML += `<li><strong>${item.name}:</strong> Your Score: ${item.user_score} (Job Importance: ${item.job_score})</li>`;
            });
            profileMatchHTML += '</ul>';

            container.innerHTML = `
                <h1>${data.title}</h1>
                <div class="detail-card">
                    <h2>Description</h2>
                    <p>${data.description}</p>
                </div>
                <div class="detail-card">
                    <h2>Job Demand</h2>
                    <p><strong>${data.demand.openings_last_7_days}</strong> openings found in the last 7 days (${data.demand.region}).</p>
                </div>
                <div class="detail-card">
                    <h2>Key Skills Required</h2>
                    <ul>
                        ${data.top_skills.map(skill => `<li>${skill.skill_name}</li>`).join('')}
                    </ul>
                </div>
                <div class="detail-card">
                    ${profileMatchHTML}
                </div>
            `;

        } catch (error) {
            container.innerHTML = `<h1>Error</h1><p>Could not load details for this job. ${error.message}</p>`;
        }
    });
</script>
</body>
</html>
